<!DOCTYPE html>
<html>

<head>
    <title>Hello Camera</title>
    <script src="https://unpkg.com/dynamsoft-camera-enhancer@2.1.0/dist/dce.js"></script>
</head>

<body>
    <div id="enhancerUIContainer" style="height: 100vh;"></div>
    <script>
        let enhancer = null;
        let isBeeping = false;

        (async () => {
            enhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance();
            document.getElementById("enhancerUIContainer").appendChild(enhancer.getUIElement());
            await enhancer.open(true);
        })();

        document.getElementById('capture').onclick = () => {
            if (enhancer) {
                let frame = enhancer.getFrame();

                // Calculate the position and size of the square
                const square = {
                    x: 100,
                    y: 100,
                    width: 200,
                    height: 200
                };

                // Draw the square on the frame canvas
                let ctx = frame.canvas.getContext('2d');
                ctx.strokeStyle = 'red';
                ctx.strokeRect(square.x, square.y, square.width, square.height);

                // Detect motion within the square
                const motionDetected = detectMotion(ctx, square);
                if (motionDetected && !isBeeping) {
                    startBeep();
                } else if (!motionDetected && isBeeping) {
                    stopBeep();
                }

                // Open a new window and display the captured frame
                let popWindow = window.open('', 'popup', 'width=640,height=640,scrollbars=yes');
                popWindow.document.body.appendChild(frame.canvas);
            }
        };

        function detectMotion(ctx, square) {
            const imageData = ctx.getImageData(square.x, square.y, square.width, square.height);
            const pixels = imageData.data;
            const threshold = 100; // Adjust this threshold as needed

            for (let i = 0; i < pixels.length; i += 4) {
                const brightness = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;

                if (brightness > threshold) {
                    return true;
                }
            }

            return false;
        }

        function startBeep() {
            // Replace this with your beep logic
            console.log("Beep start");
            isBeeping = true;
        }

        function stopBeep() {
            // Replace this with your beep logic
            console.log("Beep stop");
            isBeeping = false;
        }
    </script>
</body>

</html>
