<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Motion Detection</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsfeat"></script>
</head>
<body>
  <a-scene embedded arjs="sourceType: webcam;">
    <!-- Camera passthrough -->
    <a-entity camera></a-entity>

    <!-- Motion detection message -->
    <a-text id="motionText" position="0 0 -5" color="red" align="center" value="Motion"></a-text>
  </a-scene>

  <script>
    // Variables to store previous frame data
    var prevImageData;

    // Initialize motion detection
    function initMotionDetection() {
      var video = document.querySelector('video');
      var canvas = document.createElement('canvas');
      var context = canvas.getContext('2d');

      // Set canvas dimensions to match video
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      // Function to compare frames for motion
      function detectMotion() {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        var imageData = context.getImageData(0, 0, canvas.width, canvas.height);

        if (prevImageData) {
          var motionDetected = jsfeat.motion_detection(prevImageData, imageData, 30);
          if (motionDetected) {
            document.getElementById('motionText').setAttribute('value', 'Motion Detected');
          } else {
            document.getElementById('motionText').setAttribute('value', 'Motion');
          }
        }

        prevImageData = new jsfeat.matrix_t(canvas.width, canvas.height, jsfeat.U8_t | jsfeat.C1_t);
        prevImageData.data.set(imageData.data);
        requestAnimationFrame(detectMotion);
      }

      detectMotion();
    }

    // Main function
    function main() {
      initMotionDetection();
    }

    main();
  </script>
</body>
</html>
