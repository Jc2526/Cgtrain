
<!DOCTYPE html>
<html>

<head>
    <title>Motion Detection with Dynamsoft Camera Enhancer</title>
    <script src="https://unpkg.com/dynamsoft-camera-enhancer@2.1.0/dist/dce.js"></script>
</head>

<body>
    <button id="startButton">Start Motion Detection</button>
    <button id="stopButton">Stop Motion Detection</button>
    <audio id="beepSound" src="beep.mp3"></audio>
    <div id="cameraFeed"></div>

    <script>
        let enhancer = null;
        let isMotionDetectionActive = false;
        const beepSound = document.getElementById('beepSound');

        document.getElementById('startButton').addEventListener('click', startMotionDetection);
        document.getElementById('stopButton').addEventListener('click', stopMotionDetection);

        async function startMotionDetection() {
            isMotionDetectionActive = true;
            enhancer = await Dynamsoft.DCE.CameraEnhancer.createInstance();
            document.getElementById("cameraFeed").appendChild(enhancer.getUIElement());
            await enhancer.open(true);
            captureFrames();
        }

        function stopMotionDetection() {
            isMotionDetectionActive = false;
            enhancer && enhancer.close();
        }

        async function captureFrames() {
            let prevFrame = null;
            while (isMotionDetectionActive) {
                const frame = enhancer.getFrame();
                // Perform motion detection logic here
                if (prevFrame && motionDetected(prevFrame, frame)) {
                    playBeepSound();
                }
                prevFrame = frame;
                await new Promise(resolve => requestAnimationFrame(resolve));
            }
        }

        function motionDetected(prevFrame, currentFrame) {
            const whiteThreshold = 200; // Adjust this threshold as needed
            const currentImageData = currentFrame.canvas.getContext('2d').getImageData(0, 0, currentFrame.videoWidth, currentFrame.videoHeight).data;

            for (let i = 0; i < currentImageData.length; i += 4) {
                // Check if the pixel is white (R, G, and B values are all above the threshold)
                if (currentImageData[i] > whiteThreshold && currentImageData[i + 1] > whiteThreshold && currentImageData[i + 2] > whiteThreshold) {
                    return true;
                }
            }

            return false;
        }

        function playBeepSound() {
            beepSound.currentTime = 0;
            beepSound.play();
        }
    </script>
</body>

</html>
