
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Motion-Triggered Photo Capture</title>
<style>
    #video {
        display: none; /* Hide the video element */
    }
</style>
</head>
<body>
    <video id="video" autoplay></video>
    <canvas id="canvas" style="display: none;"></canvas>
    <button id="captureButton">Capture</button>
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const captureButton = document.getElementById('captureButton');
        let isCapturing = false;

        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(stream) {
                video.srcObject = stream;
                video.onloadedmetadata = function(e) {
                    video.play();
                    detectMotion();
                };
            })
            .catch(function(err) {
                console.log("An error occurred: " + err);
            });

        async function detectMotion() {
            const prevFrame = captureFrame();
            while (true) {
                await new Promise(resolve => requestAnimationFrame(resolve));
                const currentFrame = captureFrame();
                const motionDetected = detectMotionBetweenFrames(prevFrame, currentFrame);
                if (motionDetected && !isCapturing) {
                    takePhoto();
                }
                prevFrame.data.set(currentFrame.data); // Update previous frame
            }
        }

        function captureFrame() {
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            return ctx.getImageData(0, 0, canvas.width, canvas.height);
        }

        function detectMotionBetweenFrames(prevFrame, currentFrame) {
            const pixelsPrev = prevFrame.data;
            const pixelsCurr = currentFrame.data;
            const threshold = 100; // Adjust this threshold as needed
            let motionDetected = false;

            for (let i = 0; i < pixelsCurr.length; i += 4) {
                const brightnessPrev = (pixelsPrev[i] + pixelsPrev[i + 1] + pixelsPrev[i + 2]) / 3;
                const brightnessCurr = (pixelsCurr[i] + pixelsCurr[i + 1] + pixelsCurr[i + 2]) / 3;

                if (Math.abs(brightnessCurr - brightnessPrev) > threshold) {
                    motionDetected = true;
                    break;
                }
            }

            return motionDetected;
        }

        function takePhoto() {
            isCapturing = true;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const photo = canvas.toDataURL('image/jpeg');
            // Here you can send the photo to a server, save it locally, or perform any other action
            console.log('Photo taken:', photo);
            setTimeout(() => { isCapturing = false; }, 5000); // Prevent continuous capturing
        }

        captureButton.addEventListener('click', () => {
            takePhoto();
        });
    </script>
</body>
</html>
